(function(c,a,d,e){var b={};b.init=function(){b.currencySign=c.edd_vars.currency_sign;b.doCal();};b.doCal=function(){var f=new Calendar({element:d(".metrics-datepicker"),presets:[{label:"Last 30 days",start:moment().subtract(29,"days"),end:moment()},{label:"Last month",start:moment().subtract(1,"month").startOf("month"),end:moment().subtract(1,"month").endOf("month")},{label:"Last 3 months",start:moment(this.latest_date).subtract(3,"month").startOf("month"),end:moment(this.latest_date).subtract(1,"month").endOf("month")}],earliest_date:"January 1, 2006",latest_date:moment(),start_date:moment().subtract(29,"days"),end_date:moment(),callback:b.callback});
f.calendarSaveDates();};b.callback=function(){var i=moment(this.start_date).format("ll"),f=moment(this.end_date).format("ll");console.debug("Start Date: "+i+"\nEnd Date: "+f);
var h={action:"edd_metrics_change_date",start:i,end:f};var g="% over the last ";d(".edd-metrics-box h2").html('<div id="circleG"><div id="circleG_1" class="circleG"></div><div id="circleG_2" class="circleG"></div><div id="circleG_3" class="circleG"></div></div>');
d(".edd-metrics-box .bottom-text span").html("").removeClass();if(d(this.element[0]).hasClass("metrics-detail")){d.post(c.ajaxurl,h,b.detailResponse);}else{d.post(c.ajaxurl,h,b.dashResponse);
}};b.dashResponse=function(f){var h=JSON.parse(f);console.log(h);var g="% over previous "+h.dates.num_days+" days";d("#revenue").text(b.currencySign+h.earnings.total);
d("#revenue-compare span").text(h.earnings.compare.percentage+g).removeClass().addClass(h.earnings.compare.classes);d("#sales").text(h.sales.count);d("#sales-compare span").text(h.sales.compare.percentage+g).removeClass().addClass(h.sales.compare.classes);
d("#yearly").text(b.currencySign+h.earnings.avgyearly.total);d("#avgyearly-compare span").text(h.earnings.avgyearly.compare.percentage+g).removeClass().addClass(h.earnings.avgyearly.compare.classes);
d("#avgpercust").text(b.currencySign+h.earnings.avgpercust.total);d("#avgpercust-compare span").text(h.earnings.avgpercust.compare.percentage+g).removeClass().addClass(h.earnings.avgpercust.compare.classes);
d("#renewals").text(h.renewals.count);d("#renewal-amount").text(b.currencySign+h.renewals.earnings);d("#renewals-compare span").text(h.renewals.compare.percentage+g).removeClass().addClass(h.renewals.compare.classes);
d("#refunds").text(h.refunds.count);d("#refund-amount").text(b.currencySign+h.refunds.losses);d("#refunds-compare span").text(h.refunds.compare.percentage+g).removeClass().addClass(h.refunds.compare.classes);
d(".detail-compare-first").text(b.currencySign+h.earnings.compare.total);d("#box-4 .bottom-text span").text(h.earnings.compare.percentage+"%");d("#box-5 .bottom-text span").text(h.earnings.detail.sixmoago.compare+"%");
d(".detail-compare-second").text(b.currencySign+h.earnings.detail.sixmoago.total);d(".detail-compare-third").text(b.currencySign+h.earnings.detail.twelvemoago.total);
};b.detailResponse=function(f){var i=JSON.parse(f);console.log("detailResponse",i);var h=b.getQueryVariable("metric");var g="% compared to this period";
switch(h){case"revenue":d("#revenue").text(b.currencySign+i.earnings.total);d("#revenue-compare span").text(i.earnings.compare.percentage+g).removeClass().addClass(i.earnings.compare.classes);
d(".detail-compare-first").text(b.currencySign+i.earnings.compare.total);d("#revenue-6mocompare span").text(i.earnings.detail.sixmoago.compare+g).removeClass().addClass(i.earnings.detail.sixmoago.classes);
d(".detail-compare-second").text(b.currencySign+i.earnings.detail.sixmoago.total);d(".detail-compare-third").text(b.currencySign+i.earnings.detail.twelvemoago.total);
d("#revenue-12mocompare span").text(i.earnings.detail.twelvemoago.compare+g).removeClass().addClass(i.earnings.detail.twelvemoago.classes);d("#earnings-today h2").text(b.currencySign+i.earnings.detail.today);
d("#earnings-this-month h2").text(b.currencySign+i.earnings.detail.this_month);d("#renewal-rate h2").text(i.yearly_renewal_rate.percent+"%");d("#yearly-renewal-compare span").text("Last "+i.yearly_renewal_rate.period+" days");
break;case"renewals":break;default:}b.doLineChart(i.lineChart);b.doDownloadChart(i.pieChart);b.doGatewayChart(i.earnings.gateways);};b.getQueryVariable=function(f){var h=c.location.search.substring(1);
var j=h.split("&");for(var g=0;g<j.length;g++){var k=j[g].split("=");if(k[0]==f){return k[1];}}return(false);};b.doLineChart=function(g){if(b.lineChart){b.lineChart.destroy();
}var h={labels:g.labels,datasets:[{label:"Revenue",fill:true,lineTension:0.1,backgroundColor:"rgba(0,115,170,.2)",borderColor:"#0073aa",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"#0073aa",pointBackgroundColor:"#fff",pointBorderWidth:2,pointHoverRadius:5,pointHoverBackgroundColor:"#0073aa",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:4,pointHitRadius:10,data:g.earnings,spanGaps:false},]};
var f=a.getElementById("metrics-line-chart");b.lineChart=new Chart(f,{type:"line",data:h,options:{scales:{xAxes:[{display:false,stacked:true}],}}});};b.doDownloadChart=function(g){if(b.downloadChart){b.downloadChart.destroy();
}var h={labels:g.labels,datasets:[{label:"Downloads",data:g.earnings,backgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"],hoverBackgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"]}]};
var f=a.getElementById("metrics-piechart-by-download");b.downloadChart=new Chart(f,{type:"pie",data:h});};b.doGatewayChart=function(g){if(b.gatewayChart){b.gatewayChart.destroy();
}console.log(g);var h={labels:g.labels,datasets:[{label:"Downloads",data:g.earnings,backgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"],hoverBackgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"]}]};
var f=a.getElementById("metrics-piechart-by-gateway");b.gatewayChart=new Chart(f,{type:"pie",data:h});};jQuery(a).ready(b.init);})(window,document,jQuery);
